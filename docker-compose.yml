services:
  mindnose:
    image: gabrielsouz/mindnose:latest
    container_name: mindnose
    ports:
      - 5000:8080
    env_file:
      - .env
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_HTTP_PORTS=8080
      - DBHOST=${DBHOST}
      - DBUSER=${DBUSER}
      - DBPASSWORD=${DBPASSWORD}
      - ASPNETCORE_URLS=http://0.0.0.0:8080
    depends_on:
      - neo4j
    volumes:
        - ./EmbeddingModels:/app/EmbeddingModels
        - ./Storage:/app/Storage
        - ${APPDATA}/Microsoft/UserSecrets:/home/app/.microsoft/usersecrets:ro
        - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro
        - ${APPDATA}/ASP.NET/Https:/home/app/.aspnet/https:ro
        - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
        
  neo4j: 
    image: neo4j:latest
    container_name: neo4j
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      - NEO4J_AUTH=${DBUSER}/${DBPASSWORD}
      - server.memory.pagecache.size=1G
      - server.memory.heap.initial_size=512m
      - server.memory.heap.max_size=1G
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
      - neo4j_plugins:/plugins

volumes:
  neo4j_data:
  neo4j_logs:
  neo4j_plugins:
